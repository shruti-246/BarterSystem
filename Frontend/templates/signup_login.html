{% extends "base.html" %}
{% block title %}Sign In / Sign Up - Barter System{% endblock %}
{% block content %}

<div class="auth-container" id="authContainer">
  <!-- Sign In Form -->
  <div class="form-container sign-in-container">
    <form id="loginForm">
      <h1>Sign In</h1>
      <span>use your account</span>
      <input type="text" id="login-username" placeholder="Username" required />
      <input type="password" id="login-password" placeholder="Password" required />
      <button type="submit">Sign In</button>
    </form>
  </div>

  <!-- Sign Up Form -->
  <div class="form-container sign-up-container">
    <form id="registerForm">
      <h1>Create Account</h1>
      <span>use your email for registration</span>
      <input type="text" id="reg-username" placeholder="Username" required />
      <input type="email" id="reg-email" placeholder="Email" required />
      <input type="password" id="reg-password" placeholder="Password" required />
      <select id="reg-role">
        <option value="buyer">Buyer</option>
        <option value="seller">Seller</option>
      </select>
      <button type="submit">Sign Up</button>
    </form>
  </div>

  <!-- Overlay -->
  <div class="overlay-container">
    <div class="overlay">
      <div class="overlay-panel overlay-left">
        <h1>Welcome Back!</h1>
        <p>To keep connected with us, please login with your personal info</p>
        <button class="ghost" id="signInBtn">Sign In</button>
      </div>
      <div class="overlay-panel overlay-right">
        <h1>Hello, Friend!</h1>
        <p>Enter your personal details and start your journey with us</p>
        <button class="ghost" id="signUpBtn">Sign Up</button>
      </div>
    </div>
  </div>
</div>

<script>
const authContainer = document.getElementById('authContainer');
document.getElementById('signUpBtn').addEventListener('click', () => {
  authContainer.classList.add('right-panel-active');
});
document.getElementById('signInBtn').addEventListener('click', () => {
  authContainer.classList.remove('right-panel-active');
});

// Register
document.getElementById('registerForm').addEventListener('submit', async (e) => {
  e.preventDefault();
  const username = document.getElementById('reg-username').value;
  const email = document.getElementById('reg-email').value;
  const password = document.getElementById('reg-password').value;
  const role = document.getElementById('reg-role').value;

  try {
    const res = await fetch("{{ url_for('register') }}", {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ username, email, password, role })
    });
    const data = await res.json();
    alert(data.message || 'Registered!');
  } catch {
    alert('Error registering user');
  }
});

// Login
document.getElementById('loginForm').addEventListener('submit', async (e) => {
  e.preventDefault();
  const username = document.getElementById('login-username').value;
  const password = document.getElementById('login-password').value;

  try {
    const res = await fetch("{{ url_for('login') }}", {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ username, password })
    });
    const data = await res.json();

    if (res.ok) {
      alert('Login successful');
      // Redirect based on role
      if (data.role === 'seller') {
        window.location.href = "{{ url_for('add_product_view') }}";
      } else {
        window.location.href = "{{ url_for('home') }}";
      }
    } else {
      alert(data.message || 'Invalid credentials');
    }
  } catch {
    alert('Error logging in');
  }
});
</script>

{% endblock %}
