{% extends "base.html" %}
{% block title %}My Products - BarterDB{% endblock %}
{% block content %}

<h1>My Products</h1>

<div class="product-list" id="product-list"></div>

<div class="back" onclick="goBack()">‚Üê Back to Dashboard</div>

<script>
const BACKEND_URL = "{{ request.host_url.rstrip('/') }}";
const myUserId = sessionStorage.getItem('user_id');

if (!myUserId) {
  alert('Please login first!');
  window.location.href = "{{ url_for('signup_login_view') }}";
}

async function loadMyProducts() {
  try {
    const res = await fetch(`${BACKEND_URL}/my_items/${myUserId}`);
    const products = await res.json();
    const container = document.getElementById('product-list');
    container.innerHTML = '';

    if (products.length === 0) {
      container.innerHTML = '<p>You and your partners have not listed any products.</p>';
    } else {
      products.forEach(prod => {
        const div = document.createElement('div');
        div.className = 'product-card';

        const ownerLabel =
          prod.owner_id == myUserId
            ? '(You)'
            : `(Partner: ${prod.owner_username})`;

        div.innerHTML = `
          <strong>${prod.name}</strong> ${ownerLabel}<br>
          ${prod.description || ''}<br>
          Category: ${prod.category || 'N/A'}<br>
          Condition: ${prod.condition || 'N/A'}<br>
          Value: $${prod.estimated_value || 0}
        `;
        container.appendChild(div);
      });
    }
  } catch (error) {
    alert('Failed to fetch products.');
  }
}

function goBack() {
  window.location.href = "{{ url_for('dashboard_view') }}";
}

loadMyProducts();
</script>

{% endblock %}


