{% extends "base.html" %}
{% block title %}Add Product - BarterDB{% endblock %}
{% block content %}
<div class="container">
  <h1>Add Product</h1>

  <input type="text" id="name" placeholder="Product Name" required>
  <textarea id="description" placeholder="Description" rows="3"></textarea>
  <input type="text" id="category" placeholder="Category" required>

  <select id="condition">
    <option value="New">New</option>
    <option value="Like New">Like New</option>
    <option value="Used">Used</option>
    <option value="Old">Old</option>
  </select>

  <input type="number" id="estimated_value" placeholder="Estimated Value" required>

  <button onclick="addProduct()">Add Product</button>
  <div class="back" onclick="goBack()">‚Üê Back to Dashboard</div>
</div>

<script>
const BACKEND_URL = "{{ request.host_url.rstrip('/') }}"; // or hardcode your deployed URL

if (!sessionStorage.getItem('user_id')) {
  alert('Please login first!');
  window.location.href = "{{ url_for('signup_login_view') }}";
}

async function addProduct() {
  const name = document.getElementById('name').value;
  const description = document.getElementById('description').value;
  const category = document.getElementById('category').value;
  const condition = document.getElementById('condition').value;
  const estimated_value = document.getElementById('estimated_value').value;
  const owner_id = sessionStorage.getItem('user_id');

  try {
    const res = await fetch(`${BACKEND_URL}/add_item`, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({
        owner_id: owner_id,
        name: name,
        description: description,
        category: category,
        condition: condition,
        estimated_value: parseFloat(estimated_value)
      })
    });

    const data = await res.json();
    alert(data.message);

    if (res.ok) {
      window.location.href = "{{ url_for('dashboard_view') }}";
    }
  } catch (error) {
    alert('Error connecting to server.');
  }
}

function goBack() {
  window.location.href = "{{ url_for('dashboard_view') }}";
}
</script>
{% endblock %}
